<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal blog of Edgar Aroutiounian">
    <meta name="author" content="Edgar Aroutiounian">
    <title>hyegar.com - Calling Google Closure programmatically</title>
    <link rel="canonical" href="http://hyegar.com">
    <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../../../../css/main.css">
    <link href="../../../../atom.xml" rel="alternate" title="hyegar.com - A personal and developer blog" type="application/atom+xml">
    <link type="text/plain" rel="author" href="../../../../humans.txt">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-57031124-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
    <header id="page_header">
    <h1><a href="../../../../" title="Home">Edgar Aroutiounian</a></h1>
</header>

    <nav id="page_navigation">
    <ul>
        <li><a href="../../../../">Home</a></li>
        <li><a href="../../../../about">About</a></li>
        <li><a href="../../../../archive">Archive</a></li>
        <li><a href="../../../../resume">Resume</a></li>
    </ul>
</nav>

    
    <section id="content">
      <article>
    <header>
        <h1>Calling Google Closure programmatically</h1>
        <span class="post-date">January  9, 2017</span> in 
        <span class="post-tags"><a href="../../../../tags/java/">java</a>, <a href="../../../../tags/google%20closure/">google closure</a>, <a href="../../../../tags/api/">api</a></span>
    </header>
    <p>This is a pretty neat post, I’ll show you how to programmatically call <a href="https://github.com/google/closure-library">Google Closure</a> in Java. Closure is an amazing project that actually optimizes <code>JavaScript</code> rather than just minifies it. (This is pretty much one of the few times you’ll see me write Java, I think the language sucks).</p>
<p>Its mostly a 2017 update of this <a href="http://blog.bolinfest.com/2009/11/calling-closure-compiler-from-java.html">post from 2009</a></p>
<p>Here’s the Java</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.hyegar.closure;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>
<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>

<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.CompilationLevel;</span>
<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.Compiler;</span>
<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.CompilerOptions;</span>
<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.SourceFile;</span>
<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.CommandLineRunner;</span>
<span class="kw">import</span><span class="im"> com.google.javascript.jscomp.CompilerOptions.LanguageMode;</span>

<span class="co">/**</span>
<span class="co"> * An example of how to call the Closure Compiler programmatically, </span>
<span class="co"> * this is LICENSED AS GPL-3.0.</span>
<span class="co"> *</span>
<span class="co"> * </span><span class="kw">@author </span><span class="co">edgar.factorial@gmail.com (Edgar Aroutiounian)</span>
<span class="co"> */</span>

<span class="kw">public</span> <span class="kw">class</span> CallCompiler {

    <span class="co">/**</span>
<span class="co">     * </span><span class="kw">@param code </span><span class="co">JavaScript source code to compile.</span>
<span class="co">     * </span><span class="kw">@return </span><span class="co">The compiled version of the code.</span>
<span class="co">     */</span>
    <span class="kw">public</span> <span class="dt">static</span> <span class="bu">String</span> <span class="fu">compile</span>(<span class="bu">String</span> code) {
	<span class="bu">Compiler</span> compiler = <span class="kw">new</span> <span class="bu">Compiler</span>();

	CompilerOptions options = <span class="kw">new</span> <span class="fu">CompilerOptions</span>();

	<span class="co">// See :</span>
	<span class="co">// closure-compiler/src/com/google/javascript/jscomp/CompilerOptions.java</span>
	<span class="co">// lines 2864-2896</span>
	options.<span class="fu">setLanguageIn</span>(LanguageMode.<span class="fu">ECMASCRIPT_2015</span>);
	options.<span class="fu">setLanguageOut</span>(LanguageMode.<span class="fu">ECMASCRIPT5_STRICT</span>);

	CompilationLevel
	    .<span class="fu">ADVANCED_OPTIMIZATIONS</span>
	    .<span class="fu">setOptionsForCompilationLevel</span>(options);

	<span class="bu">List</span>&lt;SourceFile&gt; list = <span class="kw">null</span>;

	<span class="kw">try</span> {
	    list =
		CommandLineRunner
		.<span class="fu">getBuiltinExterns</span>(CompilerOptions.<span class="fu">Environment</span>.<span class="fu">BROWSER</span>);
	} <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
	    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Exception raised&quot;</span>);
	}

	list.<span class="fu">add</span>(SourceFile.<span class="fu">fromCode</span>(<span class="st">&quot;input.js&quot;</span>, code));
	compiler.<span class="fu">compile</span>(<span class="kw">new</span> <span class="bu">ArrayList</span>&lt;SourceFile&gt;(), list, options);
	<span class="kw">return</span> compiler.<span class="fu">toSource</span>();
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
      <span class="bu">String</span> compiled_code = <span class="fu">compile</span>(<span class="st">&quot;var a = 1 + 2; console.log(a)&quot;</span>);
      <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(compiled_code);
    }

}</code></pre></div>
<p>You’ll need to have the Closure Compiler installed, on OS X this is easy with <code>brew install closure-compiler</code></p>
<p>Then in a new directory that you can use for this build, you can copy the <code>jar</code> from <code>/usr/local/Cellar/closure-compiler/20161201/libexec</code> to where the root is of your directory, let’s call that directory <code>build</code>.</p>
<p>Here’s a Makefile which will build, run the code.</p>
<div class="sourceCode"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span class="dv">blog_code:</span>
	javac -Xlint:deprecation -cp ./closure-compiler-v20161201.jar:./ com/hyegar/closure/CallCompiler.java
	java -cp ./closure-compiler-v20161201.jar:./ com.hyegar.closure.CallCompiler	</code></pre></div>
</article>

    </section>

    <footer id="page_footer">
    <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC-4.0</a>
    &mdash;
    Built with 
    <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    &mdash;
    Source on 
    <a href="https://github.com/fxfactorial/hblog">GitHub</a>
    &mdash;
    <a href="http://hyegar.com/atom.xml">RSS feed</a>
</footer>

  </body>
</html>
