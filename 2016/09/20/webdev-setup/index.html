<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal blog of Edgar Aroutiounian">
    <meta name="author" content="Edgar Aroutiounian">
    <title>hyegar.com - ReactJS, JSX, async/await, babel, webpack and getting it all working</title>
    <link rel="canonical" href="http://hyegar.com">
    <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../../../../css/main.css">
    <link href="../../../../atom.xml" rel="alternate" title="hyegar.com - A personal and developer blog" type="application/atom+xml">
    <link type="text/plain" rel="author" href="../../../../humans.txt">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-57031124-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
    <header id="page_header">
    <h1><a href="../../../../" title="Home">Edgar Aroutiounian</a></h1>
</header>

    <nav id="page_navigation">
    <ul>
        <li><a href="../../../../">Home</a></li>
        <li><a href="../../../../about">About</a></li>
        <li><a href="../../../../archive">Archive</a></li>
        <li><a href="../../../../resume">Resume</a></li>
    </ul>
</nav>

    
    <section id="content">
      <article>
    <header>
        <h1>ReactJS, JSX, async/await, babel, webpack and getting it all working</h1>
        <span class="post-date">September 20, 2016</span> in 
        <span class="post-tags"><a href="../../../../tags/async/">async</a>, <a href="../../../../tags/babel/">babel</a>, <a href="../../../../tags/webpack/">webpack</a>, <a href="../../../../tags/npm/">npm</a>, <a href="../../../../tags/await/">await</a></span>
    </header>
    <h3 id="stranger-in-a-strange-land">Stranger in a strange land</h3>
<p>I’m not primarily a front-end dev so getting everything setup and configured for web development is particularly frustrating for me and most blog posts, tutorials don’t actually give explanations, just copy-pasting blindly tons of little configs.</p>
<p>Here’s my post that I’m using as reference for me and hopefully for any other non-frontend developer that wants to use the latest and greatest <code>JavaScript</code> like <code>fetch</code>, <code>async</code>, <code>await</code>, <code>React</code>, <code>JSX</code>.</p>
<h3 id="getting-started-compiling-javascript-to-javascript">Getting started, compiling JavaScript to …JavaScript</h3>
<p>Because of fragmentation in implementations of the latest <code>JavaScript</code> features, we’ll use <code>babel</code> to compile our <code>JavaScript</code> using the latest features to <code>JavaScript</code> that will work in <code>Chrome</code>, <code>Firefox</code> and <code>Safari</code>.</p>
<p><code>babel</code> has a concept of <code>plugins</code>. These are like features that you can turn on during the compilation steps and are pretty granular. Often you’ll want a whole bunch of plugins together and that is so common enough that <code>babel</code> has something called <code>presets</code>. You can put that in separate <code>.babelrc</code> file, but I prefer not having so much silly little config files, so you can also put it in your package.json; example:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"> <span class="st">&quot;babel&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;presets&quot;</span><span class="op">:</span> [
      <span class="st">&quot;react&quot;</span><span class="op">,</span>
      <span class="st">&quot;es2015&quot;</span><span class="op">,</span>
      <span class="st">&quot;stage-3&quot;</span>
    ]<span class="op">,</span>
    <span class="st">&quot;plugins&quot;</span><span class="op">:</span> [
        <span class="st">&quot;transform-es2015-modules-commonjs&quot;</span><span class="op">,</span>
        <span class="st">&quot;transform-async-to-generator&quot;</span><span class="op">,</span>
        <span class="st">&quot;transform-runtime&quot;</span>
    ]
  <span class="op">}</span></code></pre></div>
<p>These are the ones I’m using to compile <code>JSX</code>, use ES6 modules, and <code>async</code>, <code>await</code>.</p>
<p>So when you invoke <code>babel</code>, it will look at the <code>package.json</code>, see the <code>babel</code> field and turn on those features, so an example invocation is:</p>
<pre class="shell"><code>$ babel lib --out-dir dist</code></pre>
<p>which will compile all the code in the <code>lib</code> directory and output the results in the <code>dist</code> directory. This process is the same for <code>node</code>.</p>
<h3 id="bundling-code">Bundling code</h3>
<p>Now we have our legal <code>JavaScript</code> for today’s browsers/node. We can bundle up everything as a single <code>JavaScript</code> file using <code>webpack</code>. I previously used <code>browserify</code> but like all things web, apparently its not hot anymore. We can invoke it like so:</p>
<pre class="shell"><code>$ webpack --progress --colors dist/homepage.js bundle.js</code></pre>
<p>where <code>bundle.js</code> is the name of the single output file that we’ll get. You can apparently do some kind of config file for webpack, yet another config file, but this is enough for me right now.</p>
<h3 id="actual-codeproject-with-jsx">Actual code/project with JSX</h3>
<p>So let’s say we have these two files, one is <code>homepage.jsx</code> and the other is <code>button.jsx</code>. Note that I use a real example of <code>async</code>, <code>await</code>, for a great explanation see <a href="https://zeit.co/blog/async-and-await">here</a>, for <code>OCaml</code> programmers, <code>await</code> is basically <code>&gt;&gt;=</code> or <code>let%lwt</code>.</p>
<p>This is <code>button.jsx</code></p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="st">'use strict'</span><span class="op">;</span>
<span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span>

<span class="kw">class</span> Button <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>

  async <span class="at">do_request</span>(e) <span class="op">{</span>
    <span class="kw">let</span> query <span class="op">=</span>
	<span class="st">'https://api.bitcoinaverage.com'</span> <span class="op">+</span>
	<span class="st">'/ticker/global/USD'</span><span class="op">;</span>
    <span class="kw">let</span> nonsense <span class="op">=</span> <span class="st">&quot;https://foo.bar&quot;</span><span class="op">;</span>
    <span class="cf">try</span> <span class="op">{</span>
      <span class="kw">let</span> pulled <span class="op">=</span> await <span class="at">fetch</span>(query)<span class="op">;</span>
      <span class="kw">let</span> body <span class="op">=</span> await <span class="va">pulled</span>.<span class="at">json</span>()<span class="op">;</span>
      <span class="va">console</span>.<span class="at">log</span>(body)<span class="op">;</span>

      await <span class="at">fetch</span>(nonsense)<span class="op">;</span>

    <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span>
      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Exception raised:&quot;</span><span class="op">,</span> e)<span class="op">;</span>
      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Logic continued'</span>)<span class="op">;</span>
    <span class="op">}</span>
  <span class="op">}</span>

  <span class="at">render</span> () <span class="op">{</span>
    <span class="kw">let</span> s <span class="op">=</span> <span class="op">{</span><span class="dt">color</span><span class="op">:</span><span class="st">'red'</span><span class="op">};</span>
    <span class="cf">return</span> (
      <span class="op">&lt;</span>p style<span class="op">={</span>s<span class="op">}</span>
	 onClick<span class="op">={</span><span class="kw">this</span>.<span class="va">do_request</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">}&gt;</span>
	Click Me
      <span class="op">&lt;</span><span class="ss">/p&gt;</span>
<span class="ss">    </span><span class="sc">)</span><span class="ss">;</span>
<span class="ss">  }</span>
<span class="ss">};</span>
<span class="ss">// Remember to put wrap in {}</span>
<span class="ss">export {Button};</span></code></pre></div>
<p>and <code>homepage.jsx</code></p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="st">'use strict'</span><span class="op">;</span>

<span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span>
<span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span>
<span class="co">// REMEMBER to do {} since button.jsx doesn't do</span>
<span class="co">// export default</span>
<span class="im">import</span> <span class="op">{</span>Button<span class="op">}</span> <span class="im">from</span> <span class="st">'./button'</span><span class="op">;</span>

<span class="kw">class</span> Page <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>
  <span class="at">render</span> () <span class="op">{</span>
    <span class="cf">return</span> (
      <span class="op">&lt;</span>div<span class="op">&gt;</span>
	Hello World
	<span class="op">&lt;</span>Button/<span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="ss">/div&gt;</span>
<span class="ss">    </span><span class="sc">)</span><span class="ss">;</span>
<span class="ss">  }</span>
<span class="ss">};</span>

<span class="ss">ReactDOM.render</span><span class="sc">(</span><span class="ss">&lt;Page/</span><span class="op">&gt;,</span>
		<span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'cont'</span>))<span class="op">;</span></code></pre></div>
<p>So all this will be compiled correctly and turned into one <code>bundle.js</code> which we can use in this <code>index.html</code></p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;body&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;cont&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;bundle.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;/body&gt;</span></code></pre></div>
<p>and when we click the button we see this in the Chrome dev tools:</p>
<pre><code>Object {24h_avg: 614.98, ask: 613.72, bid: 613.05, last: 613.56, timestamp: &quot;Tue, 20 Sep 2016 20:09:30 -0000&quot;…}
bundle.js:23085 GET https://foo.bar/ net::ERR_NAME_NOT_RESOLVED_callee$ @ bundle.js:23085tryCatch @ bundle.js:23242invoke @ bundle.js:23516prototype.(anonymous function) @ bundle.js:23275step @ bundle.js:23872(anonymous function) @ bundle.js:23883
bundle.js:23095 Exception raised: TypeError: Failed to fetch(…)
bundle.js:23096 Logic continued</code></pre>
<p>Yay, things worked.</p>
<p>See the repo <a href="https://github.com/fxfactorial/react-example-with-async-await-babel">here</a> for the full <code>package.json</code></p>
</article>

    </section>

    <footer id="page_footer">
    <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC-4.0</a>
    &mdash;
    Built with 
    <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    &mdash;
    Source on 
    <a href="https://github.com/fxfactorial/hblog">GitHub</a>
    &mdash;
    <a href="http://hyegar.com/atom.xml">RSS feed</a>
</footer>

  </body>
</html>
